generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model User {
  id               Int               @id @default(autoincrement()) @db.UnsignedInt
  email            String            @unique @db.VarChar(50)
  password         String            @db.VarChar(200)
  name             String            @default("User") @db.VarChar(50)
  gender           Int?              @db.UnsignedTinyInt
  phone            String?           @unique @db.Char(11)
  emailVerified    Boolean           @default(false) @map("email_verified")
  emailPreferences EmailPreference[]
  preferences      Preference[]
  userSessions     UserSession[]
  properties       Property[]        @relation("PropertyToUser")

  @@map("users")
}

model EmailPreference {
  userId Int  @map("user_id") @db.UnsignedInt
  type   Int  @db.UnsignedTinyInt
  user   User @relation(fields: [userId], references: [id])

  @@id([userId, type])
  @@map("email_preferences")
}

model UserSession {
  id        Int      @id @default(autoincrement()) @db.UnsignedInt
  userId    Int      @map("user_id") @db.UnsignedInt
  token     String   @db.VarChar(255)
  expiresAt DateTime @map("expires_at") @db.DateTime(0)
  createdAt DateTime @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt DateTime @updatedAt @map("updated_at") @db.DateTime(0)
  user      User     @relation(fields: [userId], references: [id])

  @@index([userId], map: "user_sessions_user_id_fkey")
  @@map("user_sessions")
}

model Preference {
  id             Int       @id @default(autoincrement()) @db.UnsignedInt
  targetSchool   String    @map("target_school") @db.VarChar(100)
  minPrice       Int?      @map("min_price") @db.UnsignedInt
  maxPrice       Int?      @map("max_price") @db.UnsignedInt
  minBedrooms    Int?      @map("min_bedrooms") @db.UnsignedTinyInt
  maxBedrooms    Int?      @map("max_bedrooms") @db.UnsignedTinyInt
  minBathrooms   Int?      @map("min_bathrooms") @db.UnsignedTinyInt
  maxBathrooms   Int?      @map("max_bathrooms") @db.UnsignedTinyInt
  regions        String?   @db.Text
  propertyType   Int?      @map("property_type") @db.UnsignedTinyInt
  minRating      Float?    @default(13) @map("min_rating")
  minCommuteTime Int?      @map("min_commute_time") @db.UnsignedInt
  maxCommuteTime Int?      @map("max_commute_time") @db.UnsignedInt
  moveInDate     DateTime? @map("move_in_date") @db.DateTime(0)
  userId         Int?      @map("user_id") @db.UnsignedInt
  user           User?     @relation(fields: [userId], references: [id])

  @@index([userId], map: "preferences_user_id_fkey")
  @@map("preferences")
}

enum RoomType {
  entire_home
  primary_bedroom
  secondary_bedroom
  shared_bedroom
  living_room
  study_room
}

model Property {
  id              Int              @id @default(autoincrement()) @db.UnsignedInt
  price           Int              @db.UnsignedInt
  address         String           @db.VarChar(60)
  regionId        Int              @map("region_id") @db.UnsignedInt
  bedroomCount    Int              @map("bedroom_count") @db.UnsignedTinyInt
  bathroomCount   Int              @map("bathroom_count") @db.UnsignedTinyInt
  parkingCount    Int              @map("parking_count") @db.UnsignedTinyInt
  propertyType    Int              @map("property_type") @db.UnsignedTinyInt
  houseId         Int              @unique(map: "house_id") @map("house_id") @db.UnsignedInt
  availableDate   DateTime?        @map("available_date") @db.DateTime(0)
  keywords        String           @db.Text
  averageScore    Float            @map("average_score") @db.Float
  descriptionEn   String?          @map("description_en") @db.VarChar(1024)
  descriptionCn   String?          @map("description_cn") @db.VarChar(1024)
  url             String           @db.VarChar(255)
  publishedAt     DateTime         @map("published_at") @db.DateTime(0)
  thumbnailUrl    String           @default("") @map("thumbnail_url") @db.VarChar(500)
  availableArea   RoomType         @default(entire_home) @map("available_area")
  region          Region           @relation(fields: [regionId], references: [id])
  property_school PropertySchool[]
  images          PropertyImage[]
  users           User[]           @relation("PropertyToUser")

  @@index([price])
  @@index([address])
  @@index([regionId])
  @@index([bedroomCount])
  @@index([bathroomCount])
  @@index([parkingCount])
  @@index([propertyType])
  @@index([houseId])
  @@index([availableDate])
  @@index([averageScore])
  @@index([publishedAt])
  @@map("properties")
}

model Region {
  id         Int        @id @default(autoincrement()) @db.UnsignedInt
  name       String     @unique @db.VarChar(255)
  state      String     @db.VarChar(20)
  postcode   Int        @db.UnsignedInt
  properties Property[]
  schools    School[]   @relation("RegionToSchool")

  @@index([name])
  @@map("regions")
}

model School {
  id              Int              @id @default(autoincrement()) @db.UnsignedInt
  name            String           @unique @db.VarChar(255)
  property_school PropertySchool[]
  regions         Region[]         @relation("RegionToSchool")

  @@index([name])
  @@map("schools")
}

model PropertySchool {
  property_id Int      @db.UnsignedInt
  school_id   Int      @db.UnsignedInt
  commuteTime Int?     @map("commute_time") @db.UnsignedInt
  properties  Property @relation(fields: [property_id], references: [id], onDelete: Cascade)
  schools     School   @relation(fields: [school_id], references: [id], onDelete: Cascade)

  @@id([property_id, school_id])
  @@index([property_id])
  @@index([school_id])
  @@map("property_school")
}

model PropertyImage {
  id           Int      @id @default(autoincrement()) @db.UnsignedInt
  propertyId   Int      @map("property_id") @db.UnsignedInt
  url          String   @db.VarChar(500)
  displayOrder Int      @default(0) @map("display_order") @db.UnsignedTinyInt
  createdAt    DateTime @default(now()) @map("created_at") @db.DateTime(0)
  property     Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@index([propertyId, displayOrder])
  @@map("property_images")
}
